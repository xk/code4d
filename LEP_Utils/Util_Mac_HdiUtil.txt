  // ----------------------------------------------------  // Nom utilisateur (OS) : Pascal Foubert  // Date et heure : 21/09/10, 12:31:16  // ----------------------------------------------------  // Méthode : Util_Mac_HdiUtil  // Description  //   Mount - unmount a DMG   //   Used in our updater  // ----------------------------------------------------  // Paramètres  // $1 (Text) Path to dmg (/xxx/xxx/xxx.dmg or :xxx:xxx:xxx.dmg)  // $2 (pointer) Point to mount-point path used to detach the dmg  // $2 (Text) Action = Attach or Detach  // --  // $0 (text) Erreur  // ----------------------------------------------------C_TEXT($0;$1;$Dmg_Path;$3;$mode)C_POINTER($2;$mount_point)C_TEXT($Action;$In;$Out;$Error)If (Count parameters=3)$Dmg_Path:=$1If (Position(":";$Dmg_Path)>0)$Dmg_Path:=Util_Mac_Path_to_Unix ($Dmg_Path)End if $mount_point:=$2$mode:=$3Case of : ($mode="Attach")  // ATTACH -------------------------------- If ($mount_point->#"")$mount_point->:=""End if $Action:="hdiutil attach "+$Dmg_Path+" -plist"LAUNCH EXTERNAL PROCESS($Action;$In;$Out;$Error)If ($Error="")  // Search for mount point name$Root:=DOM Parse XML variable($Out)If (OK=1)  //Get the first group$Array:=DOM Find XML element($Root;"/plist/dict/array")If (OK=1)  //Get first child.... should be <dict>  // And read next$Dict:=DOM Get first child XML element($Array)If (OK=1)Repeat DOM GET XML ELEMENT NAME($Dict;$Dict_Value)If (OK=1) & ($Dict_Value="dict")$Unit:=DOM Get first child XML element($Dict)If (OK=1)DOM GET XML ELEMENT NAME($Unit;$Unit_Value)Repeat If ($Unit_Value="key")DOM GET XML ELEMENT VALUE($Unit;$Txt_Value)If ($Txt_Value="mount-point")$Unit:=DOM Get next sibling XML element($Unit)If (OK=1)DOM GET XML ELEMENT VALUE($Unit;$Txt_Value)If (OK=1)$mount_point->:=$Txt_ValueEnd if End if End if End if $Unit:=DOM Get next sibling XML element($Unit)If (OK=1)DOM GET XML ELEMENT NAME($Unit;$Unit_Value)End if Until ($Unit_Value="") | (OK=0) | ($mount_point->#"")End if End if $Dict:=DOM Get next sibling XML element($Dict)If (OK=1)DOM GET XML ELEMENT NAME($Dict;$Dict_Value)End if Until ($Dict_Value="") | (OK=0) | ($mount_point->#"")End if End if DOM CLOSE XML($Root)End if Else $0:=$ErrorEnd if : ($mode="Detach")  // DETACH -------------------------------- If ($mount_point->="")$0:="No mount point"Else $Action:="hdiutil detach "+$mount_point->LAUNCH EXTERNAL PROCESS($Action;$In;$Out;$Error)$0:=$ErrorEnd if Else $0:="Mode incorrecte"End case Else $0:="Nombre de paramètres incorrectes"End if 