  //@use:  // MH_Init_ExternalDBIf (False)  //=================  //@METHOD: MH_Init_ExternalDB  //@brief: Setup the external database if needed  //=================  //@author: jpupier  //@modified_by:  //---------  //@version: 1.0  //@date: 22 oct, 2010  //=================  //@SVN_Folder: MH_/Else   //=================C_TEXT($External_DB_SQLPath_t)  //  //=================End if   //=================  // Create the repository folder if not foundIf (Test path name(MH_Get_RepositoryRoot )#Is a directory)CREATE FOLDER(MH_Get_RepositoryRoot )End if   //$External_DB_Path_t:=MH_Get_RepositoryRoot +MH_Get_RepositoryFileName +".4DB"  // full system path$External_DB_SQLPath_t:=MH_Get_HistoPath If (Test path name($External_DB_SQLPath_t)#Is a document)  // Create the exernal database if neededCONFIRM("Create a new db repository for "+MH_Get_Hostname +"?")If (OK=0)C_TEXT($disabled_t)$disabled_t:="disabled"MH_Prefs ("set";"method_history";->$disabled_t)ALERT("new db repository not created.\rMethod history turned off.")Else   // I add an UID for PK, if you want to use replicationBegin SQLCREATE DATABASE IF NOT EXISTS DATAFILE :$External_DB_SQLPath_t;USE DATABASE DATAFILE :$External_DB_SQLPath_t;CREATE TABLE IF NOT EXISTS METHOD_HISTORY (UID UUID AUTO_GENERATE, ChangeList INT32 AUTO_INCREMENT, SubmitDate TIMESTAMP, SubmitTime DURATION, SubmitBy VARCHAR, MethodName VARCHAR, MethodContent TEXT, MethodType VARCHAR, MethodLen INT32);/* Just to speedup the queryies in the dialog*/CREATE INDEX MethodName_idx ON METHOD_HISTORY (MethodName);CREATE INDEX MethodType_idx ON METHOD_HISTORY (MethodType);/* Following if you want to use replicate & synchronize */ALTER TABLE METHOD_HISTORY ADD PRIMARY KEY (UID);ALTER TABLE METHOD_HISTORY ENABLE REPLICATE;USE LOCAL DATABASE DEFAULT;End SQLEnd if End if   //=================  // eom