  //@SVN_Folder: MH_/C_TEXT($1;$Objectname_t)$Objectname_t:=""If (Count parameters>=1)$Objectname_t:=$1  // Object name is uniqueEnd if Case of : ($Objectname_t="btn_Parse_o")  //======================= [ btn_Parse_o ] ===========================C_TEXT($Root_t)$Root_t:=OBJECT Get pointer(Object named;"Import_root")->If (Test path name($Root_t)=Is a directory)C_LONGINT($Recursive_l;$iMaxDepth)$Recursive_l:=OBJECT Get pointer(Object named;"Import_Recursive")->$iMaxDepth:=0If ($Recursive_l=1)$iMaxDepth:=MAXLONGEnd if ARRAY TEXT($FullFilePaths_at;0)ARRAY BOOLEAN(MH_Import_Select_ab;0)ARRAY TEXT(MH_Import_SubDir_at;0)ARRAY TEXT(MH_Import_FName_at;0)ARRAY TEXT(MH_FileType_at;0)ARRAY TEXT(MH_MethodType_at;0)ARRAY DATE(MH_Import_Date_ad;0)ARRAY TEXT(MH_Import_Time_at;0)ARRAY TEXT(MH_Import_FPath_at;0)FILE_Get_FPaths_HDocuments ($Root_t;->$FullFilePaths_at;$iMaxDepth)MH_ParseImportRoot ($Root_t;->$FullFilePaths_at;->MH_Import_Select_ab;->MH_Import_SubDir_at;->MH_Import_FName_at;->MH_FileType_at;->MH_MethodType_at;->MH_Import_Date_ad;->MH_Import_Time_at;->MH_Import_FPath_at)LISTBOX SORT COLUMNS(*;"ImportLB_al_o";1;<;2;>)LISTBOX COLLAPSE(*;"ImportLB_al_o";True;Listbox All)LISTBOX EXPAND(*;"ImportLB_al_o";True;Listbox Break row;1;1)End if   //======================= [ btn_ShowRoot_o ] ===========================: ($Objectname_t="btn_ShowRoot_o")  //======================= [ btn_ShowRoot_o ] ===========================C_TEXT($Root_t)$Root_t:=OBJECT Get pointer(Object named;"Import_root")->If (Test path name($Root_t)=Is a directory)SHOW ON DISK($Root_t)End if : ($Objectname_t="btn_DoImport_o")  //======================= [ btn_DoImport_o ] ===========================C_TEXT($root)C_TEXT($SubmitBy_t)C_DATE($SubmitDate_d)C_TIME($SubmitTime_h)C_LONGINT($createnews_l;$update_structure_l)C_LONGINT($loop_l)C_BOOLEAN($Selected_b)C_TEXT($Type_t)C_TEXT($MethodName_t)C_TEXT($MethodType_t)C_LONGINT($MethodLen_l)C_TEXT($MethodContent_t)C_TEXT($External_DB_SQLPath_t)C_TEXT($MH_Enabled_t;$SVN_Enabled_t)C_LONGINT($imported_l;$skipped_l;$errors_l)$root:=OBJECT Get pointer(Object named;"import_root")->$SubmitDate_d:=OBJECT Get pointer(Object named;"import_date")->$SubmitBy_t:=OBJECT Get pointer(Object named;"import_user")->$SubmitTime_h:=?00:00:00?$createnews_l:=OBJECT Get pointer(Object named;"import_createnews")->$update_structure_l:=OBJECT Get pointer(Object named;"update_structure")->MH_Prefs ("get";"method_history";->$MH_Enabled_t)MH_Prefs ("get";"svn";->$SVN_Enabled_t)$External_DB_SQLPath_t:=MH_Get_HistoPath $imported_l:=0$skipped_l:=0$errors_l:=0If ($MH_Enabled_t="enabled")Begin SQLUSE DATABASE DATAFILE :$External_DB_SQLPath_t;End SQLEnd if C_TEXT($FullPath_t)For ($loop_l;1;Size of array(MH_Import_Select_ab))$Selected_b:=MH_Import_Select_ab{$loop_l}$Type_t:=MH_FileType_at{$loop_l}If ($Selected_b=True) & (($Type_t="TEXT") | ($Type_t="txt"))$FullPath_t:=MH_Import_FPath_at{$loop_l}$MethodName_t:=MH_Import_FName_at{$loop_l}$MethodType_t:=MH_MethodType_at{$loop_l}$MethodContent_t:=TEXT_Document_to_Text ($FullPath_t)$MethodLen_l:=Length($MethodContent_t)If ($MethodName_t#"") & ($MethodContent_t#"")C_LONGINT($Count_l)$Count_l:=0  // Update if MH enabledIf ($MH_Enabled_t="enabled")Begin SQLSELECT COUNT(*) FROM METHOD_HISTORY WHERE MethodName = :$MethodName_t INTO :$Count_l;End SQLIf ($Count_l=0) & ($createnews_l=0)  // skip unknown methods$skipped_l:=$skipped_l+1Else Begin SQLINSERT INTO METHOD_HISTORY   (SubmitDate, SubmitTime, SubmitBy, MethodName, MethodContent, MethodType, MethodLen) VALUES (:$SubmitDate_d, :$SubmitTime_h, :$SubmitBy_t, :$MethodName_t, :$MethodContent_t, :$MethodType_t, :$MethodLen_l);End SQLIf (OK=1)$imported_l:=$imported_l+1Else $errors_l:=$errors_l+1End if End if End if   // Insert in structureIf ($SVN_Enabled_t="enable")If (Is compiled mode)Else ARRAY LONGINT($Properties_al;7)$Properties_al{1}:=1C_BLOB($Blob_x)C_TEXT($Folder_t)C_LONGINT($ErrorCode_l)TEXT TO BLOB($MethodContent_t;$Blob_x;Mac C string)If (AP Does method exist ($MethodName_t)=1)$ErrorCode_l:=AP Modify method ($methodName_t;$Blob_x)Else $ErrorCode_l:=AP Create method ($MethodName_t;$Properties_al;$Blob_x;$Folder_t)End if End if End if End if End if End for   //Begin SQLUSE LOCAL DATABASE DEFAULT;End SQL  //CONFIRM("Imported records: "+String($imported_l)+"\rSkipped methods: "+String($skipped_l)+"\rErrors: "+String($errors_l))  //: ($Objectname_t="ImportLB_al_o")  //======================= [ ImportLB_al_o ] ===========================Case of : (Form event=On Selection Change)C_LONGINT($Col;$Row)LISTBOX GET CELL POSITION(*;"ImportLB_al_o";$Col;$Row)If (Size of array(MH_Import_FPath_at)>=$Row) & ($Row>0)MH_Import_FName_t:=MH_Import_FName_at{$Row}MH_ImportContent_t:=TEXT_Document_to_Text (MH_Import_FPath_at{$Row})Else MH_Import_FName_t:=""MH_ImportContent_t:=""End if End case : (Count parameters=0)  //======================= [ Form method ] ===========================Case of : (Form event=On Load)C_POINTER($Root_t_p;$ptr_p)C_TEXT($SVN_Root_t)ARRAY BOOLEAN(MH_Import_Select_ab;0)ARRAY TEXT(MH_FileType_at;0)ARRAY TEXT(MH_Import_SubDir_at;0)ARRAY TEXT(MH_Import_FName_at;0)$Root_t_p:=OBJECT Get pointer(Object named;"Import_root")MH_Prefs ("get";"svn_local";->$SVN_Root_t)$Root_t_p->:=$SVN_Root_t+MH_Get_Hostname +Folder separator$ptr_p:=OBJECT Get pointer(Object named;"import_user")$ptr_p->:="imported by "+Current machine owner$ptr_p:=OBJECT Get pointer(Object named;"import_date")$ptr_p->:=Current dateMH_ImportContent_t:=""End case End case 