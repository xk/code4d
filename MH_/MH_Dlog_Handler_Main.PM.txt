  //@SVN_Folder: MH_/C_TEXT($1;$ObjectName_t)$ObjectName_t:=""If (Count parameters>=1)$ObjectName_t:=$1End if Case of : ($ObjectName_t="bRevealRepo_o")  // Reveal repositoryMH_Bttn_SetHelpTip ("Reveal repository")Case of : (Form event=On Clicked)SHOW ON DISK(MH_Get_RepositoryRoot )End case : ($ObjectName_t="bCompare_o")  // Compare revisionsMH_Bttn_SetHelpTip ("Compare revisions")Case of : (Form event=On Clicked)C_LONGINT($Line1_l;$Line2_l)C_BOOLEAN($Continue_b)C_POINTER($LB_Ptr_p)$Continue_b:=FalseCase of : (MH_CurrentView_t="FlatView")$LB_Ptr_p:=->MH_LB_FlatView: (MH_CurrentView_t="RevisionView")$LB_Ptr_p:=->MH_LB_RevisionView: (MH_CurrentView_t="UDView")$LB_Ptr_p:=->MH_LB_UDView: (MH_CurrentView_t="DUView")$LB_Ptr_p:=->MH_LB_DUViewEnd case $Line1_l:=Find in array($LB_Ptr_p->;True)$Line2_l:=Find in array($LB_Ptr_p->;True;$Line1_l+1)Case of : ($Line1_l=-1): ($Line2_l=-1): ($Line1_l=$Line2_l)Else $Continue_b:=TrueEnd case If ($Continue_b)  // global variables used in the PROCESS HTML TAG  // See in resource folder of the component for javascriptMH_Diff_Title1_t:=MH_MethodName_at{$Line1_l}+" (cl:"+String(MH_Changelist_al{$Line1_l})+")"MH_Diff_Content_1_t:=MH_MethodContent_at{$Line1_l}MH_Diff_Title2_t:=MH_MethodName_at{$Line2_l}+" (cl:"+String(MH_Changelist_al{$Line2_l})+")"MH_Diff_Content_2_t:=MH_MethodContent_at{$Line2_l}If (MH_MethodName_at{$Line1_l}#MH_MethodName_at{$Line2_l})CONFIRM("Are you sure you want to compare 2 different methods?")$Continue_b:=(OK=1)End if End if If ($Continue_b)C_LONGINT($Ref)$Ref:=Open form window("MethodHistory_Compare";Plain form window;Horizontally Centered;Vertically Centered)DIALOG("MethodHistory_Compare";*)Else ALERT("Select 2 revisions to compare.")End if End case : ($ObjectName_t="P4Merge_o")  // Compare with diff toolMH_Bttn_SetHelpTip ("Launch external diff.")Case of : (Form event=On Clicked) & (False)C_TEXT($a)$a:=Request("Command line";"p4merge -C 'utf8'"): (Form event=On Clicked)C_LONGINT($Line1_l;$Line2_l)C_BOOLEAN($Continue_b)C_POINTER($LB_Ptr_p)$Continue_b:=FalseCase of : (MH_CurrentView_t="FlatView")$LB_Ptr_p:=->MH_LB_FlatView: (MH_CurrentView_t="RevisionView")$LB_Ptr_p:=->MH_LB_RevisionView: (MH_CurrentView_t="UDView")$LB_Ptr_p:=->MH_LB_UDView: (MH_CurrentView_t="DUView")$LB_Ptr_p:=->MH_LB_DUViewEnd case $Line1_l:=Find in array($LB_Ptr_p->;True)$Line2_l:=Find in array($LB_Ptr_p->;True;$Line1_l+1)Case of : ($Line1_l=-1): ($Line2_l=-1): ($Line1_l=$Line2_l)Else $Continue_b:=TrueEnd case If ($Continue_b)  // global variables used in the PROCESS HTML TAG  // See in resource folder of the component for javascriptMH_Diff_Title1_t:=MH_MethodName_at{$Line1_l}+" ("+String(MH_Changelist_al{$Line1_l})+")"MH_Diff_Content_1_t:=MH_MethodContent_at{$Line1_l}MH_Diff_Title2_t:=MH_MethodName_at{$Line2_l}+" ("+String(MH_Changelist_al{$Line2_l})+")"MH_Diff_Content_2_t:=MH_MethodContent_at{$Line2_l}If (MH_MethodName_at{$Line1_l}#MH_MethodName_at{$Line2_l})CONFIRM("Are you sure you want to compare 2 different methods?")$Continue_b:=(OK=1)End if End if If ($Continue_b)C_TEXT($pathnew;$pathold)$pathnew:=Temporary folder+MH_MethodName_at{$Line1_l}+"_"+String(MH_Changelist_al{$Line1_l})+".txt"$pathold:=Temporary folder+MH_MethodName_at{$Line2_l}+"_"+String(MH_Changelist_al{$Line2_l})+".txt"TEXT_Text_to_Document ($pathnew;MH_Diff_Content_1_t)TEXT_Text_to_Document ($pathold;MH_Diff_Content_2_t)  //LAUNCH EXTERNAL PROCESS("p4merge -C 'utf8' "+$pathright+" "+$pathleft)C_TEXT($cmd_line)MH_Prefs ("get";"ext_diff";->$cmd_line)$cmd_line:=Replace string($cmd_line;"%new";$pathnew)$cmd_line:=Replace string($cmd_line;"%old";$pathold)SET ENVIRONMENT VARIABLE("_4D_OPTION_BLOCKING_EXTERNAL_PROCESS";"false")LAUNCH EXTERNAL PROCESS($cmd_line)Else ALERT("Select 2 revisions to compare in the list")End if End case : ($ObjectName_t="bExport_o")  // Export HEAD revisionMH_Bttn_SetHelpTip ("Export HEAD revision")Case of : (Form event=On Clicked)C_TEXT($Root_t)C_TEXT($CurrentMethodName_t;$CurrentMethodType_t)C_TEXT($MethodContent_t)C_LONGINT($Loop_l)C_DATE($Date)C_TIME($Time)C_TEXT($year;$month;$day;$hour;$Min;$Sec)$Date:=Current date$Time:=Current time$year:=String(Year of($Date);"0000")$month:=String(Month of($Date);"00")$day:=String(Day of($Date);"00")$hour:=String($Time\3600;"00")$Min:=String(($Time\60)%60;"00")$Sec:=String($Time%60;"00")  //$Root_t:=Select folder("Select folder where to export")$Root_t:=MH_Get_RepositoryRoot +"HEAD_"+$year+$month+$day+"_"+$hour+$Min+$Sec+Folder separatorIf (Test path name($Root_t)#Is a directory)CREATE FOLDER($Root_t)End if If (Test path name($Root_t)=Is a directory)ARRAY TEXT($MH_MethodName_at;0)ARRAY TEXT($MH_MethodType_at;0)COPY ARRAY(MH_MethodName_at;$MH_MethodName_at)COPY ARRAY(MH_MethodType_at;$MH_MethodType_at)SORT ARRAY($MH_MethodName_at;$MH_MethodType_at;>)ARRAY TEXT($AlreadyExported_at;0)For ($Loop_l;1;Size of array($MH_MethodName_at))$CurrentMethodName_t:=$MH_MethodName_at{$Loop_l}$CurrentMethodType_t:=$MH_MethodType_at{$Loop_l}If (Find in array($AlreadyExported_at;$CurrentMethodName_t)=-1)APPEND TO ARRAY($AlreadyExported_at;$CurrentMethodName_t)$MethodContent_t:=MH_Get_LatestVersion_Content ($CurrentMethodName_t)TEXT_Text_to_Document ($Root_t+$CurrentMethodName_t+"."+$CurrentMethodType_t+".txt";$MethodContent_t)End if End for SHOW ON DISK($Root_t)End if End case : ($ObjectName_t="bImport_o")  // Import from text files in MHMH_Bttn_SetHelpTip ("Import from HEAD folder...")Case of : (Form event=On Clicked)C_LONGINT($ref)$ref:=Open form window("MethodHistory_Import";Plain form window;Horizontally Centered;Vertically Centered)DIALOG("MethodHistory_Import")CLOSE WINDOW($ref)End case : ($ObjectName_t="bRefresh_o")  // Refresh ListboxMH_Bttn_SetHelpTip ("Refresh listbox")Case of : (Form event=On Clicked)MH_Dialog_Load_in_LB End case : ($ObjectName_t="bPrefs_o")  // Preferences dlogMH_Bttn_SetHelpTip ("Preferences...")Case of : (Form event=On Clicked)C_LONGINT($refWindow_l)C_LONGINT($winType_l)If (Folder separator=":")$winType_l:=Sheet form windowElse $winType_l:=Plain form windowEnd if $refWindow_l:=Open form window("MethodHistory_Preferences";$winType_l;Horizontally Centered;Vertically Centered)DIALOG("MethodHistory_Preferences")CLOSE WINDOW($refWindow_l)End case : ($ObjectName_t="bGrow_o")  // Grow bttnC_LONGINT($wLeft;$wTop;$wRight;$wBottom)GET WINDOW RECT($wLeft;$wTop;$wRight;$wBottom)If (DisplayDetail_b)SET WINDOW RECT($wLeft;$wTop;$wRight-800;$wBottom)  //OBJECT SET TITLE(*;"bGrow";">")OBJECT SET FORMAT(*;"bGrow";"Expand;#icons/MH_application_side_expand.png;;;0;1;8;0;0;0;0")Else SET WINDOW RECT($wLeft;$wTop;$wRight+800;$wBottom)OBJECT SET FORMAT(*;"bGrow";"Collapse;#icons/MH_application_side_contract.png;;;0;1;8;0;0;0;0")End if DisplayDetail_b:=Not(DisplayDetail_b): (Count parameters=0)  // form methodCase of : (Form event=On Load)  // local varsC_TEXT($db_name_t;$db_vers_t)C_DATE($db_date_d)C_POINTER($cb_ProjectMethod_p)C_LONGINT($left;$top;$right;$bottom)ARRAY TEXT($Names_at;0)ARRAY LONGINT($Numbers_al;0)  //  // Get component informationMH_Get_Component_infos ("name";->$db_name_t)MH_Get_Component_infos ("version";->$db_vers_t)MH_Get_Component_infos ("date";->$db_date_d)  // Display in the window titleSET WINDOW TITLE($db_name_t+" - version "+$db_vers_t+" ("+String($db_date_d)+")")  //  // Set the proper size for the serach picker : use the size of the red /// rectangleOBJECT GET COORDINATES(*;"MH_Like_t_size";$left;$top;$right;$bottom)OBJECT MOVE(*;"MH_Like_t_o";$left;$top;$right;$bottom;*)SearchPicker SET HELP TEXT ("MH_Like_t_o";"Method name (case sensitive)")  //  // Fill array for tabsARRAY TEXT(MH_TabView_at;4)MH_TabView_at{1}:="Chronological view"MH_TabView_at{2}:="Revision view"MH_TabView_at{3}:="View by User/Date"MH_TabView_at{4}:="View by Date/User"MH_CurrentView_t:="FlatView"  //  // Setup initial values of checkboxes$cb_ProjectMethod_p:=OBJECT Get pointer(Object named;"cb_ProjectMethod_o")$cb_ProjectMethod_p->:=1  //  // Window is collapsed by defaultDisplayDetail_b:=False  //  // Init some varsMH_HelpTip:=""MH_MethodContent_t:=""MH_MethodName_t:=""  //  // Populate the listboxMH_Dialog_Load_in_LB   //  //MH_fourDPackInstalled_b:=FalsePLUGIN LIST($Numbers_al;$Names_at)MH_fourDPackInstalled_b:=(Find in array($Names_at;"4D_Pack")>0)  //End case Else End case 