  //@use:  // MH_Prefs ($Selector:txt  ;$PrefName_t:txt ; ->$Prefvalue_t:txt)If (False)  //=================  //@METHOD: MH_Prefs  //@brief: Handles the preferences for this component  //=================  //@params:  // $1 (_t): Selector ("set" | "get")  // $2 (_t): Prefname   //           general preferences : "ext_diff"   //           preferences for this host : "repo_root", "repo_name", "method_history"  //                                          "svn" , "svn_local", "svn_url", "svn_login", "svn_password"  // $3 (_t_p): Prefvalue  //=================  //@author: jpupier  //---------  //@version: 1.0  //@date: 14 jun, 2010  //=================  //@SVN_Folder: MH_/Else   //=================C_TEXT($1;$Selector_t)C_TEXT($2;$PrefName_t)C_POINTER($3;$PrefValue_t_p)  //---------C_LONGINT($ParamCount_l)C_TEXT($HostName_t;$PrefPath;$PrefValue_t;$xPath_t)C_TEXT($Prefs_dom;$RefHost_dom;$Ref_dom)C_BOOLEAN($continue_b)$ParamCount_l:=Count parameters  //  //=================End if   //=================If ($ParamCount_l>=3)$Selector_t:=$1$PrefName_t:=$2$PrefValue_t_p:=$3$continue_b:=TrueCase of : ($PrefName_t="ext_diff"): ($PrefName_t="repo_root"): ($PrefName_t="repo_name"): ($PrefName_t="method_history"): ($PrefName_t="svn"): ($PrefName_t="svn_local"): ($PrefName_t="svn_url"): ($PrefName_t="svn_login"): ($PrefName_t="svn_password")Else TRACE$continue_b:=FalseEnd case If ($continue_b)  // Get the host database name, without any extension$HostName_t:=MH_Get_Hostname   // Path of the preference file, in the 4D folder$PrefPath:=Get 4D folder+"MethodHistoty.prf"If (Test path name($PrefPath)#Is a document)  // If the file does not exists, create a new one, with default preferences$Prefs_dom:=DOM Create XML Ref("preferences")  // add the default values$Ref_dom:=DOM Create XML element($Prefs_dom;"preferences/ext_diff";"value";"p4merge -C 'utf8' %new %old")  // write to fileDOM EXPORT TO FILE($Prefs_dom;$PrefPath)DOM CLOSE XML($Prefs_dom)End if $Prefs_dom:=DOM Parse XML source($PrefPath)  // find the prefs path for this host$RefHost_dom:=DOM Find XML element by ID($Prefs_dom;$HostName_t)If ($RefHost_dom="") | ($RefHost_dom=("0"*16))  // if values are not inited  // set default values for this host$xPath_t:="preferences/hosts/host"ARRAY TEXT($AttributeNames_at;0)ARRAY TEXT($AttributeValues_at;0)APPEND TO ARRAY($AttributeNames_at;"id")  // name of the host databaseAPPEND TO ARRAY($AttributeValues_at;$HostName_t)APPEND TO ARRAY($AttributeNames_at;"repo_root")  // dflt repository folder nameAPPEND TO ARRAY($AttributeValues_at;"repository")APPEND TO ARRAY($AttributeNames_at;"repo_name")  // dflt repository database nameAPPEND TO ARRAY($AttributeValues_at;"mh_"+$HostName_t)APPEND TO ARRAY($AttributeNames_at;"method_history")  // method history disabledAPPEND TO ARRAY($AttributeValues_at;"disabled")APPEND TO ARRAY($AttributeNames_at;"svn")  // SVN disabled APPEND TO ARRAY($AttributeValues_at;"disabled")APPEND TO ARRAY($AttributeNames_at;"svn_local")  // APPEND TO ARRAY($AttributeValues_at;"")APPEND TO ARRAY($AttributeNames_at;"svn_url")  // APPEND TO ARRAY($AttributeValues_at;"")APPEND TO ARRAY($AttributeNames_at;"svn_login")  // APPEND TO ARRAY($AttributeValues_at;"")APPEND TO ARRAY($AttributeNames_at;"svn_password")  // APPEND TO ARRAY($AttributeValues_at;"")$RefHost_dom:=DOM Create XML element arrays($Prefs_dom;$xPath_t;$AttributeNames_at;$AttributeValues_at)DOM EXPORT TO FILE($Prefs_dom;$PrefPath)End if Case of : ($Selector_t="get")  // ========= GET ==============Case of   // general preferences: ($PrefName_t="ext_diff")$Ref_dom:=DOM Find XML element($Prefs_dom;"preferences/"+$PrefName_t)DOM GET XML ATTRIBUTE BY NAME($Ref_dom;"value";$PrefValue_t)Else   // host preferencesDOM GET XML ATTRIBUTE BY NAME($RefHost_dom;$PrefName_t;$PrefValue_t)End case $PrefValue_t_p->:=$PrefValue_t  //: ($Selector_t="set")  // ========= SET ==============$PrefValue_t:=$PrefValue_t_p->  //Case of : ($PrefName_t="ext_diff")$Ref_dom:=DOM Find XML element($Prefs_dom;"preferences/"+$PrefName_t)DOM SET XML ATTRIBUTE($Ref_dom;"value";$PrefValue_t)Else DOM SET XML ATTRIBUTE($RefHost_dom;$PrefName_t;$PrefValue_t)End case DOM EXPORT TO FILE($Prefs_dom;$PrefPath)End case DOM CLOSE XML($Prefs_dom)End if End if   //=================  //eom